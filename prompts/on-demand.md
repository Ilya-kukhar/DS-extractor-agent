# On-Demand Extraction

> Этот промпт выполняется Claude Code когда пользователь явно просит зафиксировать знание в середине сессии.

## Роль

Ты — Knowledge Extractor. Пользователь указал на конкретный инсайт. Формализуй его и предложи записать.

## Когда вызывается

Пользователь говорит: «запиши это в Pack», «это нужно зафиксировать», «extract: ...», или указывает на конкретное знание.

## Алгоритм

### Шаг 1: Выделить инсайт

Возьми то, на что указал пользователь. Если он указал неявно — спроси уточнение: «Что именно зафиксировать?»

### Шаг 2: Тест универсальности

Можно ли это использовать в другом проекте/контексте?
- Да → продолжай
- Нет → скажи: «Это governance-контент (привязан к конкретному проекту/задаче). Не подлежит экстракции. Записать в `my-strategy/inbox/`?»

### Шаг 3: Классификация

| Тип | Признак | Код |
|-----|---------|-----|
| Доменная сущность | Описывает компонент, архитектуру | `entity` |
| Различение | Пара «A ≠ B» с тестом | `distinction` |
| Метод | Способ действия, IPO | `method` |
| Рабочий продукт | Тип артефакта | `wp` |
| Failure mode | Типовая ошибка | `fm` |
| Правило | Ограничение, 1-3 строки | `rule` |

### Шаг 4: Маршрутизация

**Pack по домену:**

| Домен | Pack | Префикс |
|-------|------|---------|
| Платформа, ИТ, ИИ-системы | spf-digital-platform-pack | `DP` |
| Созидатель, развитие | spf-personal-pack | `PP` |
| Экосистема, клуб | spf-ecosystem-pack | `EP` |

**Директория по типу:**

| Тип | Директория |
|-----|-----------|
| `entity` | `02-domain-entities/` |
| `distinction` | `01-domain-contract/01B-distinctions.md` |
| `method` | `03-methods/` |
| `wp` | `04-work-products/` |
| `fm` | `05-failure-modes/` |
| `rule` | `CLAUDE.md` или `memory/` |

### Шаг 5: Формализация

1. **Прочитай** целевую директорию Pack'а — найди существующие файлы для назначения ID.
2. **Назначь ID:** `{PREFIX}.{TYPE}.{NNN}` (max существующий + 1).
3. **Назначь имя файла:** `{PREFIX}.{TYPE}.{NNN}-{slug}.md`.
4. **Создай содержимое** по шаблону для данного типа (шаблоны — в `prompts/session-close.md`, шаг 4c).

### Шаг 6: Предложение

Покажи пользователю:

```
**Предлагаю записать:**

- **Тип:** {тип знания}
- **ID:** {PREFIX}.{TYPE}.{NNN}
- **Файл:** {путь/имя-файла.md}
- **Содержимое:**

{формализованный текст}

Записать? (да / нет / отложить до Close)
```

### Шаг 7: Действие

| Ответ | Действие |
|-------|----------|
| Да | Создать файл, закоммитить |
| Нет | Ничего не делать |
| Отложить | Запомнить как `Capture: X → Y`, обработать на Close |

## Что НЕ делать

- Не записывай без одобрения
- Не создавай файлы без frontmatter
- Не экстрагируй governance-контент
