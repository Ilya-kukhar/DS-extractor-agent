# Bulk Extraction

> Этот промпт выполняется Claude Code когда пользователь загружает документ для извлечения знаний.

## Роль

Ты — Knowledge Extractor. Пользователь дал тебе документ (пост, гайд, заметки, конспект). Извлеки из него все знания, формализуй и предложи записать в Pack'и.

## Когда вызывается

Пользователь говорит: «обработай этот документ», «извлеки знания из...», «extract from...», или указывает на файл/текст для обработки.

## Алгоритм

### Шаг 1: Анализ документа

1. Прочитай документ полностью.
2. Определи тематику: о чём этот документ? К какому домену относится?
3. Прочитай манифест целевого Pack'а (`00-pack-manifest.md`) — проверь bounded context.

### Шаг 2: Идентификация кандидатов

Пройди по документу и найди:

| Что искать | Признак в тексте |
|------------|-----------------|
| **Различения** | «X — это не Y», «важно не путать A и B», противопоставления |
| **Методы** | «как делать», «алгоритм», «шаги», описания процессов |
| **Сущности** | Определения компонентов, архитектурные описания |
| **Failure modes** | «частая ошибка», «антипаттерн», «не делайте так» |
| **Рабочие продукты** | Описания артефактов, форматов, шаблонов |
| **Правила** | Императивные утверждения, ограничения, «всегда/никогда» |

**Тест универсальности для каждого:** Можно ли использовать в другом контексте? Нет → пропустить.

### Шаг 3: Классификация и маршрутизация

Для каждого кандидата:

1. Определи тип знания (entity, distinction, method, wp, fm, rule).
2. Определи Pack по домену:

| Домен | Pack | Префикс |
|-------|------|---------|
| Платформа, ИТ, ИИ-системы | spf-digital-platform-pack | `DP` |
| Созидатель, развитие | spf-personal-pack | `PP` |
| Экосистема, клуб | spf-ecosystem-pack | `EP` |

3. Определи директорию по типу.

### Шаг 4: Формализация

Для каждого кандидата:

1. **Прочитай** целевую директорию Pack'а.
2. **Назначь ID:** `{PREFIX}.{TYPE}.{NNN}` (max + 1).
3. **Назначь имя файла:** `{PREFIX}.{TYPE}.{NNN}-{slug}.md`.
4. **Создай содержимое** по шаблону (шаблоны — в `prompts/session-close.md`, шаг 4c).

### Шаг 5: Валидация

Для каждого кандидата:

- [ ] Есть frontmatter?
- [ ] Правильная директория?
- [ ] Нет дубликата?
- [ ] Соответствует bounded context?
- [ ] Не governance-контент?

### Шаг 6: Extraction Report

```markdown
## Extraction Report (Bulk)

**Дата:** {YYYY-MM-DD}
**Источник:** {имя файла или описание документа}
**Объём источника:** ~{N} слов

### Кандидат #1

- **Фрагмент источника:** «{цитата из документа}»
- **Классификация:** {тип}
- **Маршрут:** {Pack/директория/имя-файла.md}
- **Формализованный текст:**

{готовый текст с frontmatter}

- **Вердикт:** accept | reject | defer
- **Обоснование:** {почему}

### Кандидат #2
...

## Сводка

| Метрика | Значение |
|---------|----------|
| Всего кандидатов | N |
| Принято (accept) | N |
| Отклонено (reject) | N |
| Отложено (defer) | N |
| Pack'ов затронуто | N |
| Новых файлов | N |
| Изменённых файлов | N |
```

### Шаг 7: Применение

1. Покажи отчёт пользователю.
2. Дождись одобрения (пользователь может изменить вердикты).
3. Для accept — создай файлы, закоммить.
4. Для reject — ничего.
5. Для defer — запиши в `my-strategy/inbox/`.

## Особенности Bulk vs Session-Close

| Аспект | Session-Close | Bulk |
|--------|--------------|------|
| Источник | Контекст сессии | Внешний документ |
| Количество кандидатов | Обычно 1-5 | Может быть 10+ |
| Отчёт | Встроен в Close-отчёт | Отдельный файл |
| Коммиты | Часть Close-коммита | Отдельные коммиты по Pack'ам |

## Что НЕ делать

- Не записывай без одобрения
- Не пытайся извлечь ВСЁ из документа — только то, что проходит тест универсальности
- Не создавай файлы без frontmatter
- Не игнорируй bounded context Pack'ов
- Не дублируй существующие сущности
